{% extends "base.html" %}

{% block title %}AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç - Binom Assistant{% endblock %}
{% block page_title %}AI –ê–≥–µ–Ω—Ç{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/chat.css?v=4">
    <link rel="stylesheet" href="/static/css/sidebar_compact.css">
    <link rel="stylesheet" href="/static/css/agent-selector.css">
{% endblock %}

{% block content %}
<div class="chat-container">
    <!-- –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π —Å–∞–π–¥–±–∞—Ä -->
    <aside class="chat-sidebar" id="chatSidebar">
        <div class="sidebar-header">
            <button class="btn-new-chat" id="newChatBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
                –ù–æ–≤—ã–π —á–∞—Ç
            </button>
        </div>

        <!-- –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ -->
        <div class="sidebar-search">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
            </svg>
            <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ —á–∞—Ç–∞–º..." id="chatSearchInput">
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —á–∞—Ç–æ–≤ -->
        <div class="sidebar-content">
            <!-- –®–∞–±–ª–æ–Ω—ã –ø—Ä–æ–º–ø—Ç–æ–≤ -->
            <div class="chat-section">
                <div class="section-header" data-section="templates">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                    </svg>
                    –®–∞–±–ª–æ–Ω—ã
                    <button class="btn-add-template" id="addTemplateBtn" title="–î–æ–±–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                    </button>
                </div>
                <div class="chat-list" id="templatesList">
                    <!-- –®–∞–±–ª–æ–Ω—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ LocalStorage —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                <button class="btn-show-more" id="showMoreTemplatesBtn" style="display: none;" onclick="showMoreTemplates()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 9l-7 7-7-7"/>
                    </svg>
                    –ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ
                </button>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤ -->
            <div class="chat-section">
                <div class="section-header" data-section="history">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/>
                    </svg>
                    –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤
                </div>
                <div class="chat-list" id="chatsList">
                    <!-- –ß–∞—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ë–î —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                <button class="btn-show-more" id="showMoreChatsBtn" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 9l-7 7-7-7"/>
                    </svg>
                    –ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ
                </button>
                <button class="btn-delete-all-chats" id="deleteAllChatsBtn" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                    </svg>
                    –£–¥–∞–ª–∏—Ç—å –≤—Å–µ
                </button>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è -->
        <button class="sidebar-toggle" id="sidebarToggle" title="–°–≤–µ—Ä–Ω—É—Ç—å —Å–∞–π–¥–±–∞—Ä">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
        </button>
    </aside>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
    <main class="chat-main">
        <!-- –®–∞–ø–∫–∞ —á–∞—Ç–∞ -->
        <header class="chat-header">
            <button class="sidebar-toggle-mobile" id="sidebarToggleMobile">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18"/>
                </svg>
            </button>

          
            <div class="chat-controls">
<!-- –í—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                <div class="agent-selector">
                    <button class="btn-select-agent" id="selectAgentBtn" title="–í—ã–±—Ä–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        <span id="selectedAgentLabel">–û–±—ã—á–Ω—ã–π —á–∞—Ç</span>
                    </button>
                </div>

                <!-- –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ -->
                <div class="model-selector">
                    <label for="modelSelect">–ú–æ–¥–µ–ª—å:</label>
                    <select id="modelSelect" class="model-select">
                        <option value="openai/gpt-4.1-mini">GPT-4.1 Mini (default)</option>
                    </select>
                    <button class="btn-select-model" id="selectModelBtn" title="–í—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 8v8M8 12h8"/>
                        </svg>
                    </button>
                </div>

                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ -->
                <div class="context-settings">
                    <label for="contextLimit" title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ AI">–ö–æ–Ω—Ç–µ–∫—Å—Ç:</label>
                    <input type="number" id="contextLimit" value="10" min="1" max="50" style="width: 60px;">
                </div>

                

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–∫–µ–Ω–∞—Ö -->
                <div class="token-info" id="tokenInfo" style="display: none;">
                    <span class="token-badge" title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                        <span id="tokenCount">0</span>
                    </span>
                </div>

                <!-- –°—Ç–æ–∏–º–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ -->
                <div class="model-price-info" id="modelPriceInfo" style="display: none;">
                    <span class="price-badge" title="–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                        <span id="modelPrice">-</span>
                    </span>
                </div>
            </div>
        </header>

        <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π -->
        <div class="chat-messages" id="chatMessages">
            <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
            <div class="welcome-message">
                <div class="welcome-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/>
                    </svg>
                </div>
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</h2>
                <p>–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –æ–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É. –Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ –º–Ω–æ–≥–∏–º –¥—Ä—É–≥–∏–º.</p>

                <div class="example-prompts">
                    <button class="example-prompt" data-prompt="–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ –∑–∞ –Ω–µ–¥–µ–ª—é">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                        –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
                    </button>
                    <button class="example-prompt" data-prompt="–ö–∞–∫–∏–µ –º–æ–¥—É–ª–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã?">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4M12 8h.01"/>
                        </svg>
                        –ö–∞–∫–∏–µ –º–æ–¥—É–ª–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã?
                    </button>
                    <button class="example-prompt" data-prompt="–ü–æ–º–æ–≥–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <path d="M12 9v4M12 17h.01"/>
                        </svg>
                        –ü–æ–º–æ–≥–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã
                    </button>
                </div>
            </div>

            <!-- –î–µ–º–æ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ -->
            <div class="message user-message">
                <div class="message-avatar">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                </div>
                <div class="message-content">
                    <div class="message-text">–ö–∞–∫ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–º–ø–∞–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü?</div>
                </div>
            </div>

            <div class="message ai-message">
                <div class="message-avatar">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <div class="message-content">
                    <div class="message-text">
                        <p>–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–º–ø–∞–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –º–æ–¥—É–ª–∏:</p>
                        <ol>
                            <li><strong>Total Performance Tracker</strong> - –ø–æ–∫–∞–∂–µ—Ç –æ–±—â—É—é –∫–∞—Ä—Ç–∏–Ω—É –ø–æ –≤—Å–µ–º –∫–∞–º–ø–∞–Ω–∏—è–º</li>
                            <li><strong>Offer Profitability Ranker</strong> - –ø–æ–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Å–∞–º—ã–µ –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ –æ—Ñ—Ñ–µ—Ä—ã</li>
                            <li><strong>Risk Assessment</strong> - –≤—ã—è–≤–∏—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏</li>
                        </ol>
                        <p>–ü–µ—Ä–µ–π—Ç–∏ –∫ –º–æ–¥—É–ª—è–º –∞–Ω–∞–ª–∏—Ç–∏–∫–∏?</p>
                    </div>
                    <div class="message-actions">
                        <button class="message-action-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                            </svg>
                            –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button class="message-action-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                            </svg>
                            –≠–∫—Å–ø–æ—Ä—Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
        <div class="chat-input-wrapper">
            <div class="chat-input-container">
                <textarea
                    id="chatInput"
                    class="chat-input"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ... (Shift+Enter –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)"
                    rows="1"
                ></textarea>
                <button class="chat-send-btn" id="sendBtn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å (Enter)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2 11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </div>
            <div class="chat-input-hint">
                –ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏, Shift+Enter –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
            </div>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–µ–π -->
    <div class="model-modal" id="modelModal">
        <div class="model-modal-overlay"></div>
        <div class="model-modal-content">
            <div class="model-modal-header">
                <h3>–í—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏</h3>
                <button class="model-modal-close" id="closeModelModal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6 6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="model-modal-body">
                <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
                <div class="model-warning">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <path d="M12 9v4M12 17h.01"/>
                    </svg>
                    <span>–ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–∞–π–¥—Ä—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π function calling —É –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ Python —Å–∫—Ä–∏–ø—Ç–æ–≤)</span>
                </div>

                <!-- –ü–æ–∏—Å–∫ -->
                <div class="model-search">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="modelSearchInput" placeholder="–ü–æ–∏—Å–∫ –º–æ–¥–µ–ª–µ–π..." autocomplete="off">
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π -->
                <div class="model-list-container">
                    <div class="model-list-loading" id="modelListLoading">
                        <div class="loading-spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π...</p>
                    </div>
                    <div class="model-list" id="modelList" style="display: none;">
                        <!-- –ú–æ–¥–µ–ª–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </div>
            <div class="model-modal-footer">
                <div class="model-footer-info">
                    
                    <span>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ "<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.003-.003.001a.752.752 0 01-.704 0l-.003-.001z"/>
                    </svg>", —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                </div>
                <button class="btn-secondary" id="closeModelModalBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞ -->
    <div class="agent-modal" id="agentModal">
        <div class="agent-modal-overlay"></div>
        <div class="agent-modal-content">
            <div class="agent-modal-header">
                <h3>–í—ã–±–æ—Ä —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞</h3>
                <button class="agent-modal-close" id="closeAgentModal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6 6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="agent-modal-body">
                <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                <div class="agent-description">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –º–æ–¥—É–ª—è–º –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω—ã–π —á–∞—Ç –±–µ–∑ –º–æ–¥—É–ª–µ–π.</p>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∞–≥–µ–Ω—Ç–æ–≤ -->
                <div class="agent-categories">
                    <!-- –û–±—ã—á–Ω—ã–π —á–∞—Ç (–±–µ–∑ –º–æ–¥—É–ª–µ–π) -->
                    <div class="agent-category" data-category="">
                        <div class="agent-category-header">
                            <div class="agent-category-icon">üí¨</div>
                            <div class="agent-category-info">
                                <h4>–û–±—ã—á–Ω—ã–π —á–∞—Ç</h4>
                                <p>–û–±—â–µ–Ω–∏–µ —Å AI –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</p>
                                <span class="agent-category-modules">–ù–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î</span>
                            </div>
                        </div>
                        <div class="agent-category-actions">
                            <button class="btn-agent-select" onclick="selectAgentCategory('');">–í—ã–±—Ä–∞—Ç—å</button>
                        </div>
                    </div>

                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    <div id="agentCategoriesList"></div>
                </div>
            </div>
            <div class="agent-modal-footer">
                <button class="btn-secondary" id="closeAgentModalBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –∞–≥–µ–Ω—Ç–æ–≤ -->
    <div class="prompt-modal" id="promptModal">
        <div class="prompt-modal-overlay"></div>
        <div class="prompt-modal-content">
            <div class="prompt-modal-header">
                <h3 id="promptModalTitle">–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∞–≥–µ–Ω—Ç–∞</h3>
                <button class="prompt-modal-close" id="closePromptModal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6 6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="prompt-modal-body">
                <div class="prompt-tabs">
                    <button class="prompt-tab active" data-tab="current" id="currentTab">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–º–ø—Ç</button>
                    <button class="prompt-tab" data-tab="default" id="defaultTab">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
                </div>

                <div class="prompt-tab-content active" id="currentTabContent">
                    <div class="prompt-status" id="promptStatus"></div>
                    <textarea id="currentPromptTextarea" class="prompt-textarea" rows="20"></textarea>
                </div>

                <div class="prompt-tab-content" id="defaultTabContent">
                    <div class="prompt-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4M12 8h.01"/>
                        </svg>
                        <span>–≠—Ç–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –µ–≥–æ, –Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è.</span>
                    </div>
                    <textarea id="defaultPromptTextarea" class="prompt-textarea" rows="20" readonly></textarea>
                </div>
            </div>
            <div class="prompt-modal-footer">
                <button class="btn-secondary" id="closePromptModalBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="btn-danger" id="resetPromptBtn" style="display: none;">–°–±—Ä–æ—Å–∏—Ç—å –∫ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–º—É</button>
                <button class="btn-primary" id="savePromptBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤ -->
    <div class="template-modal" id="templateModal">
        <div class="template-modal-overlay"></div>
        <div class="template-modal-content">
            <div class="template-modal-header">
                <h3 id="templateModalTitle">–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω</h3>
                <button class="template-modal-close" id="closeTemplateModal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6 6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="template-modal-body">
                <div class="template-form-group">
                    <label for="templateName">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</label>
                    <input type="text" id="templateName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω–∞–ª–∏–∑ ROI" class="template-input">
                </div>
                <div class="template-form-group">
                    <label for="templatePrompt">–¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞</label>
                    <textarea id="templatePrompt" rows="6" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞..." class="template-textarea"></textarea>
                </div>
                <div class="template-form-group">
                    <label>–ò–∫–æ–Ω–∫–∞</label>
                    <div class="template-icons-grid" id="templateIconsGrid">
                        <button class="template-icon-option" data-icon="chart" title="–ì—Ä–∞—Ñ–∏–∫">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3v18h18"/>
                                <path d="m19 9-5 5-4-4-3 3"/>
                            </svg>
                        </button>
                        <button class="template-icon-option" data-icon="grid" title="–°–µ—Ç–∫–∞">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/>
                                <rect x="14" y="3" width="7" height="7"/>
                                <rect x="14" y="14" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/>
                            </svg>
                        </button>
                        <button class="template-icon-option" data-icon="alert" title="–ê–ª–µ—Ä—Ç">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <path d="M12 9v4M12 17h.01"/>
                            </svg>
                        </button>
                        <button class="template-icon-option" data-icon="file" title="–î–æ–∫—É–º–µ–Ω—Ç">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                            </svg>
                        </button>
                        <button class="template-icon-option" data-icon="search" title="–ü–æ–∏—Å–∫">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                        </button>
                        <button class="template-icon-option" data-icon="settings" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="template-modal-footer">
                <button class="btn-secondary" id="cancelTemplateBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-primary" id="saveTemplateBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}

<style>
@media (max-width: 480px) {    
.content-wrapper {padding: 0px !important;}
.chat-sidebar.compact .sidebar-toggle {transform: rotate(180deg); right: -10px;}
.chat-messages {border-radius: 0;}
}
</style>

<!-- Markdown –ø–∞—Ä—Å–µ—Ä -->
<script src="/static/js/marked.min.js"></script>

<!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–¥–∞ -->
<link rel="stylesheet" href="/static/css/highlight-atom-one-dark.min.css">
<script src="/static/js/highlight.min.js"></script>

<script src="/static/js/chat.js?v=35"></script>
{% endblock %}
